\documentclass[NumTh.tex]{subfiles}
\begin{document}

\subsection{Counting lattice points}

How many integer pairs $(x,y)$ solve the Diophantine inequality
\[ x^2 + y^2 \leq T \text{?} \]
What about
\[ 3 x^2 + 5 y^2 + 7 z^2 \leq T \text{,} \]
or more generally
\[F(\underline{x}) \leq T \text{,} \]
where $F$ is a positive definite quadratic form in $n$ variables?
Even more generally, let $S \subset \R^n$ and $\Lambda$ a lattice in $\R^n$, we would like to get a (non-trivial) estimate for $(\Lambda \cap S)$.\\

Suppose $S$ is measurable and "nicely shaped", and let 
\[ F_v = [0,1) b_1 + \dots + [0,1) b_n + v \; (v \in \Lambda) \] 
be a fundamental cell (with respect to basis $b_1,\dots,b_n$).\\

The idea is as follows:
$\abs{\Lambda \cap S} \approx $ number of $F_v$'s that lie in $S \approx \frac{\vol(S)}{\vol(F_v)} = \frac{\vol(S)}{\det(\Lambda)}$

\todo{"Nice set"} %TODO picture
\todo{"Bad set"} %TODO picture

To characterize nice sets we use the following definition.

\begin{defi*}
  Let $n \geq 2$, $M$ be in $\N$ and $L \geq 0$ real.
  We say the set $Z$ lies in \underline{$\lip(n,M,L)$} if
  \begin{itemize}
    \item $Z \subset \R^n$
    \item there exist $M$ maps $\phi_i: [0,1]^{n-1} \to \R^n$ %TODO mising text
  \end{itemize}
  satisfying a Lipschitz condition with constant $L$, i.e.,
  \[ \norm{\phi_i(x) - \phi_i(y)} \leq L \norm{x-y} \; \forall x,y \in [0,1]^{n-1} \]
  and such that the union of their images covers $Z$, i.e.,
  \[ Z \subset \cup_{i=1}^M \phi_i([0,1]^{n-1}) \text{.} \]
\end{defi*}

\begin{ex}
  The sphere $S^\prime \subset \R^2$ lies in $\lip(2,1,2\pi)$.
  \[ \phi(x) = (\cos(2\pi x), \sin(2 \pi x)) \text{ for } 0 \leq x \leq 1 \]
\end{ex}

We can now state the main result of Section 5.
Recall that the boundary $\partial S$ of $S \subset \R^n$ is defined by the topological closure $\bar{S}$ minus the interior $\inner(S)$ of $S$.
\[ \partial S = \bar{S} \setminus \inner(S)\]
We follow an approach of Masser and Vaaler.

\begin{theorem}\label{2_5_1}
  Let $S \subset \R^n$ be bounded and suppose that $\partial S \in \lip(n,M,L)$.
  Let $\Lambda$ be a lattice in $\R^n$ and $\lambda_1$ its first successive minimum with respect to the unit ball.
  Then, $S$ is measurable and
  \[ \abs{\abs{\Lambda \cap S} - \frac{\vol(S)}{\det \Lambda}} \leq c \cdot M \cdot \left( \frac{L}{\lambda_1} + 1 \right)^{n-1} \]
  where $c$ is a constant depending only on $n$.
\end{theorem}

For the proof we need the following lemma.

\begin{lemma}\label{2_5_2}
  Let $S \subset \R^n$ be bounded and measurable and let $\Lambda$ be a lattice in $\R^n$.
  Let $b_1,\dots,b_n$ be a basis of $\Lambda$, $F_v = [0,1)b_1 + \dots + [0,1)b_n + v$ the corresponding fundamental cells and write
  \[ \mathcal{T} = \abs{\{v \in \Lambda: F_v \cap \partial S \neq \emptyset\} } \text{,} \]
  the number of cells that intersect the boundary $\partial S$ of $S$.
  Then 
  \[ \abs{\abs{\Lambda \cap S} - \frac{\vol S}{\det \Lambda}} \leq \mathcal{T} \]
\end{lemma}

\begin{proof}
  The cells $F_v$ ($v \in \Lambda$) define a partition of $\R^n$.
  Every $F_v$ contains exactly one lattice point, namely $v$.
  Let $m = \abs{\{v \in \Lambda : F_v \subset S \}}$.
  Then $m \leq \abs{S \cap \Lambda}$.\\
  Now suppose $v \in S$.
  Then either $F_v \subset S$ or $F_v$ contains a point from $S$ and from its complement $S^C$.
  The connecting line segment of these points lies in $F_v$ as $F_v$ is convex and it must contain a point of the boundary $\partial S$.
  Hence, 
  \[ \abs{\Lambda \cap S} \leq m + \mathcal{T} \text{.} \]
  Now $\vol F_v = \det \Lambda$, and the union of all cells $F_v$ that lie in $S$ has volume $m \cdot \det \Lambda$.
  The volume of the union of cells $F_v$ that have non-empty intersection with $S$ is at most $(m + \mathcal{T}) \det \Lambda$.
  So we have proved the inequalities
  \begin{itemize}
    \item $m \leq \abs{\Lambda \cap S} \leq (m + \mathcal{T})$
    \item $m \cdot \det \Lambda \leq \vol S \leq (m + \mathcal{T}) \det \Lambda$
  \end{itemize}
  Thus \[ \abs{\abs{\Lambda \cap S} - \frac{\vol S}{\det \Lambda}} \leq \mathcal{T}\]
\end{proof}

We can now prove Theorem \ref{2_5_1}.

\begin{proof}[Proof of Theorem \ref{2_5_1}]
  We use $c_1,c_2,c_3,c_4,c_5,c_6,c_7$ to denote constants that depend only on $n$.\\
  First let's assume $\Lambda = \Z^n$, so $\lambda_1 = 1$.
  We take the standard basis $b_i = c_i \; (1\leq i\leq n)$ and apply Lemma \ref{2_5_2}; so $\mathcal{T} = \mathcal{T}(e_1,\dots,e_n)$.
  We split $[0,1]^{n-1}$ into $L_1^{n-1}$ subcubes of side length $\frac{1}{L_1}$ where $L_1 = [L] + 1$. %TODO replace [] by \floor  
  The images of these subcubes under the parametrizing maps $\phi$ have diameter at most $L \cdot \frac{c_1}{L_1} \leq c_1$.
  Thus, no more than $c_2 = (c_1 + 2)^n$ cells $F_v$ can meet such a single image (= the image of a single subcube).
  Hence, 
  \begin{align}
    \mathcal{T} \leq M \cdot c_2 \cdot L_1^{n-1} \leq M \cdot c_2 \cdot (L + 1)^{n-1} \label{5_1}
  \end{align}
  As $\lambda_1(\Z^n) = 1$ this proves the claim for $\Lambda = \Z^n$ thanks to Lemma \ref{2_5_1}.
  
  Now let $\Lambda$ be an arbitrary lattice.
  By Corollary \ref{2_3_6} there exists a basis $b_1,\dots,b_n$ of $\Lambda$ such that
  \[ \abs{b_i} \leq c_3 \lambda_i \; (1 \leq i \leq n) \]
  where $\lambda_1,\dots,\lambda_n$ are the successive minima with respect to the unit ball.
  Let 
  \[ A^{-1} = \left( b_1 \dots b_n \right) \in \gl_n(\R) \text{,} \]
  so that 
  \[ A(\Lambda) = \Z^n \text{.} \]
  Now 
  \[ \abs{S \cap \Lambda} = \abs{A(S \cap \Lambda)} = \abs{A(S) \cap A(\Lambda)} = \abs{A(S) \cap \Z^n} \text{.} \]
  So we can apply the case $\Lambda = \Z^n$ to the set $A(S)$.
  The boundary $\partial A(S)$ can  be parametrized by the $M$ maps $\psi(x) = A(\phi(x))$ which satisfy
  \[ \norm{\psi(x) - \psi(y)} \leq \norm{A} \cdot L \norm{x-y} \text{,}\]
  where $\norm{A}$ denotes the Euclidean operator norm of $A$.\\
  By Cramer's rule the entries of row $i$ of $A$ are of the form $\frac{\mu}{\det \Lambda}$, 
  where $\mu$ is a minor of the matrix with columns $b_1,\dots,b_n$ omitting $b_i$.
  Using Hadamard's inequality we conclude 
  \[ \abs{\mu} \leq \frac{\norm{b_1} \cdots \norm{b_n}}{\norm{b_i}} \leq c_4 \cdot \frac{\lambda_1 \cdots \lambda_n}{\lambda_i} \text{.}\]
  By Minkowski's Second Theorem we have
  \[ \lambda_1,\dots,\lambda_n \leq c_5 \cdot \det \Lambda \text{.} \]
  Hence, each entry of $A$ has absolute value at most $\frac{c_6}{\lambda_1}$.
  It follows 
  \[ \norm{A} \leq \frac{c_7}{\lambda_1} \text{.} \]
  Replacing $L$ in (\ref{5_1}) by $\frac{c_7 L}{\lambda_1}$ proves the theorem.
\end{proof}

\begin{rem}
  We have not shown that $S$ is measurable.
  One could do that by showing that $\partial S$ has measure zero, and noting that every closed set is measurable.\\
  Why is $\vol(\partial S) = 0$?
  Take $\Lambda = k^{-1} \Z^n$ where $k \in \N$, and $\mathcal{T}$ be associated to the basis $k^{-1} e_1, \dots, k^{-1}e_n$.
  The proof of Theorem \ref{2_5_1} yields
  \[ \mathcal{T} \leq c_n M \left( \frac{L}{k^{-1}} + 1 \right)^{n-1} \leq c_n M (L+1)^{n-1} k^{n-1} \text{.} \]
  Since 
  \[\vol(\partial S) \leq \mathcal{T} \vol F_v \leq c_n M (L+1)^{n-1} k^{n-1} k^{-n} \to 0 \text{ as } k \to \infty \text{.} \]
  Hence $\vol(\partial S) = 0$.
\end{rem}


In some applications a more precise error term is needed that involves also the higher successive minima.
With a bit more effort the following result could be proved.

\begin{theorem}\label{2_5_3}
  Same hyptothesis as in Theorem \ref{2_5_1} and $\lambda_1,\dots,\lambda_n$ successive minima with respect to the unit ball.
  Then 
  \[ \abs{\abs{\Lambda \cap S} - \frac{\vol S}{\det \Lambda}} \leq c M \underbrace{\max_{0 \leq i < n} \frac{L}{\lambda_1 \cdot \lambda_i}}_{\coloneq 1 \text{ for } i = 0} \]
  \todo{Professor: compare with Adrian}
  and $c = n^{3n^2}$.
\end{theorem}

\end{document}
